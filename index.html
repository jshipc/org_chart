<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Organization Chart — JSON Inline Accordion</title>
  <style>
    /* Universal box-sizing so padding/margin calculations are predictable */
    * { box-sizing: border-box; }

    /* Base body styling: system font for readability, limit width for easy reading */
    body {
      font-family: system-ui, sans-serif;
      line-height: 1.5;
      margin: 0;
      padding: 1rem;
      max-width: 80ch;
    }

    /* Responsive heading size */
    h1 {
      font-size: clamp(1.25rem, 2.5vw, 1.75rem);
      margin-bottom: 1rem;
    }

    /* Remove index numbers from ordered lists, keep indentation */
    ol {
      padding-left: 1.25rem;
      list-style: none;
    }

    /* Add slight space between accordion sections */
    details {
      margin: 0.25rem 0;
    }

    /* Make summary clickable */
    summary {
      cursor: pointer;
    }

    /* Hide default disclosure triangle across browsers */
    details > summary { list-style: none; }
    details > summary::marker { content: ""; }
    details > summary::-webkit-details-marker { display: none; }

    /* Custom disclosure icons */
    summary::before {
      content: "▸ "; /* right arrow when closed */
      transition: transform .2s ease;
    }
    details[open] > summary::before {
      content: "▾ "; /* down arrow when open */
    }

    /* Contact link styles */
    .contacts { font-size: 0.9em; margin-left: .5rem; white-space: nowrap; }
    .contacts a { text-decoration: underline; }
    .sep { margin: 0 .25rem; }

    /* Two-line entry layout */
    .name-line { font-weight: bold; }
    .title-line { font-size: 0.9em; color: #333; margin-left: 1.2em; }
  </style>
</head>
<body>
  <h1>Organization Chart</h1>
  <!-- Container where JavaScript will insert the generated org chart -->
  <div id="org-chart"></div>

  <script>
  /*
    Inline JSON data representing the org structure.
    Fields:
      - firstName: string (person's given name)
      - lastName: string (person's surname)
      - title: string (job title)
      - phone: string | null (SMS contact number, null if unavailable)
      - email: string | null (email address, null if unavailable)
      - subordinates: array of similar role objects (optional)
  */
  const orgData = {
    firstName: "Alice", lastName: "Smith", title: "Chief Executive Officer (CEO)", phone: "+15550000001", email: "ceo@example.com",
    subordinates: [
      {
        firstName: "Bob", lastName: "Johnson", title: "VP of Operations", phone: null, email: "ops.vp@example.com",
        subordinates: [
          { firstName: "Carol", lastName: "Lee", title: "Operations Manager — Region A", phone: "+15550000021", email: null },
          { firstName: "David", lastName: "Wong", title: "Operations Manager — Region B", phone: "+15550000022", email: "opsb.manager@example.com" }
        ]
      },
      {
        firstName: "Evelyn", lastName: "Clark", title: "VP of Finance", phone: "+15550000002", email: "finance.vp@example.com"
      }
    ]
  };

  /*
    Build a contact chip that shows:
      - "SMS" link if phone exists, otherwise "none"
      - "Email" link if email exists, otherwise "none"
    Output format: [ SMS | Email ]
  */
  function contactChip(role) {
    const wrap = document.createElement('span');
    wrap.className = 'contacts';

    // SMS link or 'none'
    const sms = document.createElement('span');
    if (role.phone) {
      const a = document.createElement('a');
      a.href = `sms:${encodeURIComponent(role.phone)}`;
      a.textContent = 'SMS';
      a.setAttribute('aria-label', `Send SMS to ${role.firstName} ${role.lastName}`);
      sms.appendChild(a);
    } else {
      sms.textContent = 'none';
    }

    // Email link or 'none'
    const email = document.createElement('span');
    if (role.email) {
      const a = document.createElement('a');
      a.href = `mailto:${encodeURIComponent(role.email)}`;
      a.textContent = 'Email';
      a.setAttribute('aria-label', `Send email to ${role.firstName} ${role.lastName}`);
      email.appendChild(a);
    } else {
      email.textContent = 'none';
    }

    // Compose the final chip
    wrap.appendChild(document.createTextNode('['));
    wrap.appendChild(sms);
    const sep = document.createElement('span');
    sep.className = 'sep';
    sep.textContent = '|';
    wrap.appendChild(document.createTextNode(' '));
    wrap.appendChild(sep);
    wrap.appendChild(document.createTextNode(' '));
    wrap.appendChild(email);
    wrap.appendChild(document.createTextNode(' ]'));
    return wrap;
  }

  /*
    Create a two-line display for one role:
      First line: First Name, Last Name, Contact chip
      Second line: Title
  */
  function roleDisplay(role) {
    const container = document.createElement('div');

    // First line: Name + contacts
    const nameLine = document.createElement('div');
    nameLine.className = 'name-line';
    nameLine.textContent = `${role.firstName} ${role.lastName} `;
    nameLine.appendChild(contactChip(role));

    // Second line: Title
    const titleLine = document.createElement('div');
    titleLine.className = 'title-line';
    titleLine.textContent = role.title;

    container.appendChild(nameLine);
    container.appendChild(titleLine);
    return container;
  }

  /*
    Recursively build the org chart:
      - If subordinates exist: wrap in <details>/<summary> and recurse
      - Otherwise: show just the role display
  */
  function createRole(role) {
    if (role.subordinates && role.subordinates.length) {
      const details = document.createElement('details');
      const summary = document.createElement('summary');
      summary.appendChild(roleDisplay(role));
      details.appendChild(summary);

      const list = document.createElement('ol');
      role.subordinates.forEach(sub => {
        const li = document.createElement('li');
        li.appendChild(createRole(sub));
        list.appendChild(li);
      });
      details.appendChild(list);
      return details;
    } else {
      return roleDisplay(role);
    }
  }

  // Prevent accordion toggle when clicking links inside a summary
  document.addEventListener('click', (e) => {
    if (e.target.closest('summary a')) e.stopPropagation();
  });

  // Build and insert the chart into the container
  document.getElementById('org-chart').appendChild(createRole(orgData));
  </script>
</body>
</html>